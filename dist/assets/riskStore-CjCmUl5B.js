import{R as l}from"./index-skxUcrdA.js";const g=t=>{let a;const e=new Set,n=(s,S)=>{const o=typeof s=="function"?s(a):s;if(!Object.is(o,a)){const b=a;a=S??(typeof o!="object"||o===null)?o:Object.assign({},a,o),e.forEach(y=>y(a,b))}},r=()=>a,i={setState:n,getState:r,getInitialState:()=>D,subscribe:s=>(e.add(s),()=>e.delete(s))},D=a=t(n,r,i);return i},p=(t=>t?g(t):g),h=t=>t;function k(t,a=h){const e=l.useSyncExternalStore(t.subscribe,l.useCallback(()=>a(t.getState()),[t,a]),l.useCallback(()=>a(t.getInitialState()),[t,a]));return l.useDebugValue(e),e}const f=t=>{const a=p(t),e=n=>k(a,n);return Object.assign(e,a),e},R=(t=>t?f(t):f),c={getAllScenarios:async()=>[],getDashboardData:async(t,a)=>(console.log(`[Backend] Fetching Dashboard Data for ${t}/${a}`),null),getMapRiskData:async(t,a)=>null,getPopulationRisk:async(t,a)=>null,getInfrastructureRisk:async(t,a)=>null},L=R((t,a)=>({selectedScenario:"SSP245",selectedYear:"2030",dashboardData:null,mapData:null,populationData:null,infrastructureData:null,scenariosList:[],isLoading:!1,error:null,setScenario:e=>{t({selectedScenario:e}),a().fetchData()},setYear:e=>{t({selectedYear:e}),a().fetchData()},fetchData:async()=>{const{selectedScenario:e,selectedYear:n}=a();t({isLoading:!0,error:null});try{const[r,u,d,i]=await Promise.all([c.getDashboardData(e,n),c.getMapRiskData(e,n),c.getPopulationRisk(e,n),c.getInfrastructureRisk(e,n)]);t({dashboardData:r,mapData:u,populationData:d,infrastructureData:i,isLoading:!1})}catch{t({error:"فشل تحميل البيانات. يرجى المحاولة مرة أخرى.",isLoading:!1})}},initialize:async()=>{t({isLoading:!0});try{const e=await c.getAllScenarios();t({scenariosList:e}),await a().fetchData()}catch{t({error:"فشل تهيئة النظام",isLoading:!1})}}}));export{L as u};
